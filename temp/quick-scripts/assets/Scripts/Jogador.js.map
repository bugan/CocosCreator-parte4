{"version":3,"sources":["Jogador.js"],"names":["Teclado","require","cc","Class","extends","Component","properties","tiro","Prefab","vidaMaxima","Float","_posicaoTiro","Node","_vidaAtual","_direcao","Vec2","_movimentacao","_controleAnimacao","_canvas","Canvas","_audioTiro","AudioSource","_eventoAlteraVida","Event","EventCustom","_eventoMorreu","onLoad","getComponent","find","on","atirar","mudarDirecaoDaAnimacao","node","sofrerDano","recuperarVida","children","update","deltaTime","verificarTeclado","andar","setDirecao","andarPraFrente","ZERO","estaPressionada","KEY","a","x","d","s","y","w","evento","detail","dano","dispararEventos","vidaAtual","cura","Math","min","dados","setUserData","dispatchEvent","event","direcao","calcularDirecaoMouse","estado","mag","mudaAnimacao","posicaoMouse","getLocation","convertToNodeSpaceAR","posicaoJogadora","Camera","main","position","sub","disparo","instantiate","iniciliza","parent","add","play"],"mappings":"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","file":"Jogador.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["let Teclado = require(\"Teclado\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tiro: cc.Prefab,\n        vidaMaxima: cc.Float,\n        _posicaoTiro: cc.Node,\n        _vidaAtual: cc.Float,\n        _direcao: cc.Vec2,\n        _movimentacao: cc.Component,\n        _controleAnimacao: cc.Component,\n        _canvas: cc.Canvas,\n        _audioTiro: cc.AudioSource,\n        _eventoAlteraVida: cc.Event.EventCustom,\n        _eventoMorreu: cc.Event.EventCustom,\n    },\n\n    onLoad: function () {\n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this._audioTiro = this.getComponent(cc.AudioSource);\n        this._canvas = cc.find(\"Canvas\");\n        this._canvas.on(\"mousedown\", this.atirar, this);\n        this._canvas.on(\"mousemove\", this.mudarDirecaoDaAnimacao, this);\n        this.node.on(\"SofreDano\", this.sofrerDano, this);\n        this.node.on(\"RecuperarVida\", this.recuperarVida, this);\n        this._vidaAtual = this.vidaMaxima;\n        this._eventoAlteraVida = new cc.Event.EventCustom(\"JogadoraPerdeuVida\", true);\n        this._eventoMorreu = new cc.Event.EventCustom(\"JogoAcabou\", true);\n        this._posicaoTiro = this.node.children[0];\n    },\n\n    update: function (deltaTime) {\n        this.verificarTeclado();\n        this.andar();\n       \n    },\n\n    andar : function(){\n        this._movimentacao.setDirecao(this._direcao);\n        this._movimentacao.andarPraFrente();\n    },\n    \n    verificarTeclado : function(){\n        this._direcao = cc.Vec2.ZERO;\n\n        if (Teclado.estaPressionada(cc.KEY.a)) {\n            this._direcao.x -= 1;\n        }\n        if (Teclado.estaPressionada(cc.KEY.d)) {\n            this._direcao.x += 1;\n        }\n\n        if (Teclado.estaPressionada(cc.KEY.s)) {\n            this._direcao.y -= 1;\n        }\n        if (Teclado.estaPressionada(cc.KEY.w)) {\n            this._direcao.y += 1;\n        }\n    },\n\n    sofrerDano: function (evento) {\n        this._vidaAtual -= evento.detail.dano;\n\n        this.dispararEventos(this._eventoAlteraVida, { vidaAtual: this._vidaAtual, vidaMaxima: this.vidaMaxima });\n        if (this._vidaAtual < 0) {\n            this.dispararEventos(this._eventoMorreu);\n        }\n    },\n\n    recuperarVida : function(evento){\n        this._vidaAtual += evento.detail.cura;\n        this._vidaAtual = Math.min(this._vidaAtual, this.vidaMaxima);\n        this.dispararEventos(this._eventoAlteraVida, { vidaAtual: this._vidaAtual, vidaMaxima: this.vidaMaxima });\n    },\n\n    dispararEventos: function (evento, dados) {\n        evento.setUserData(dados);\n        this.node.dispatchEvent(evento);\n    },\n\n    mudarDirecaoDaAnimacao: function (event) {\n        let direcao = this.calcularDirecaoMouse(event);\n        let estado;\n        if (this._direcao.mag() == 0) {\n            estado = \"Parado\";\n        } else {\n            estado = \"Andar\";\n        }\n        this._controleAnimacao.mudaAnimacao(direcao, estado);\n    },\n\n    calcularDirecaoMouse: function (event) {\n        let posicaoMouse = event.getLocation();\n        posicaoMouse = new cc.Vec2(posicaoMouse.x, posicaoMouse.y);\n        posicaoMouse = this._canvas.convertToNodeSpaceAR(posicaoMouse);\n        let posicaoJogadora = cc.Camera.main.node.convertToNodeSpaceAR(this.node.position);\n\n        let direcao = posicaoMouse.sub(posicaoJogadora);\n        return direcao;\n    },\n\n    atirar: function (event) {\n        let disparo = cc.instantiate(this.tiro);\n        let direcao = this.calcularDirecaoMouse(event);\n        disparo.getComponent(\"Tiro\").iniciliza(this.node.parent, this.node.position.add(this._posicaoTiro.position), direcao);\n\n        this._audioTiro.play();\n    },\n    \n});\n"]}