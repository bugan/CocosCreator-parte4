{"version":3,"sources":["Inimigo.js"],"names":["cc","Class","extends","Component","properties","alvo","Node","dano","Float","vida","distanciaAtaque","distanciaPerseguir","tempoVagar","_atacando","_direcaoVagar","Vec2","_movimentacao","_controleAnimacao","_cronometroVagar","_morto","_vidaAtual","onLoad","getComponent","audioMorte","AudioSource","find","node","on","sofrerDano","UP","update","deltaTime","direcaoAlvo","position","sub","console","log","distancia","mag","iniciarAtaque","andar","vagar","mudaAnimacao","atacar","emit","direcao","setDirecao","andarPraFrente","Math","random","evento","detail","vidaAtual","vidaMaxima","morrer","mul","destruirZumbi","eventoMorte","Event","EventCustom","dispatchEvent","destroy"],"mappings":"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","file":"Inimigo.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        alvo: cc.Node,\n        dano: cc.Float,\n        vida: cc.Float,\n        distanciaAtaque: cc.Float,\n        distanciaPerseguir: cc.Float,\n        tempoVagar: cc.Float,\n\n        _atacando: false,\n        _direcaoVagar: cc.Vec2,\n        _movimentacao: cc.Component,\n        _controleAnimacao: cc.Component,\n        _cronometroVagar: cc.Float,\n        _morto: false,\n        _vidaAtual: false,\n    },\n\n    onLoad: function () {\n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this.audioMorte = this.getComponent(cc.AudioSource);\n\n        this.alvo = cc.find(\"Personagens/Personagem\");\n        this.node.on(\"SofrerDano\", this.sofrerDano, this);\n\n        this._direcaoVagar = cc.Vec2.UP;\n        this._cronometroVagar = this.tempoVagar;\n\n        this._vidaAtual = this.vida;\n    },\n\n    update: function (deltaTime) {\n        \n        if (!this._morto && !this._atacando) {\n            let direcaoAlvo = this.alvo.position.sub(this.node.position);\n            console.log(direcaoAlvo);\n            let distancia = direcaoAlvo.mag();\n\n            if (distancia < this.distanciaAtaque) {\n                this.iniciarAtaque(direcaoAlvo);            \n            } else if (distancia < this.distanciaPerseguir) {\n                this.andar(direcaoAlvo);\n            } else {\n                this.vagar(deltaTime);\n            }\n        }\n    },\n\n    iniciarAtaque: function(direcaoAlvo){\n        this._controleAnimacao.mudaAnimacao(direcaoAlvo, \"Ataque\");\n        this._atacando = true;\n    },\n\n    atacar: function () {\n        this._atacando = false;\n        this.alvo.emit(\"SofreDano\", { dano: this.dano });\n    },\n\n    andar: function (direcao) {\n        this._movimentacao.setDirecao(direcao);\n        this._movimentacao.andarPraFrente();\n        this._controleAnimacao.mudaAnimacao(direcao, \"Andar\");\n    },\n\n    vagar: function (deltaTime) {\n        this._cronometroVagar -= deltaTime;\n\n        if (this._cronometroVagar < 0) {\n            this._direcaoVagar = new cc.Vec2(Math.random() - .5, Math.random() - .5);\n            this._cronometroVagar = this.tempoVagar;\n        }\n\n        this.andar(this._direcaoVagar);\n    },\n\n    sofrerDano: function (evento) {\n        this._vidaAtual -= evento.detail.dano;\n\n        this.node.emit(\"atualizarVida\", { vidaAtual: this._vidaAtual, vidaMaxima: this.vida });\n        if (this._vidaAtual < 0) {\n            this.morrer();\n        }\n    },\n\n    morrer: function () {\n        this._morto = true;\n        let direcao = cc.Vec2.UP.mul(-1);\n        this._controleAnimacao.mudaAnimacao(direcao, \"Morte\");\n    },\n\n    destruirZumbi: function () {\n        let eventoMorte = new cc.Event.EventCustom(\"ZumbiMorreu\", true);\n        this.node.dispatchEvent(eventoMorte);\n        this.node.emit(\"SoltarItem\");\n        this.node.destroy();\n    }\n    \n});\n"]}