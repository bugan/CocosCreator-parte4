{"version":3,"sources":["Inimigo.js"],"names":["cc","Class","extends","Component","properties","alvo","Node","dano","Float","vida","distanciaAtaque","distanciaPerseguir","tempoVagar","_atacando","_direcaoVagar","Vec2","_movimentacao","_controleAnimacao","_cronometroVagar","_morto","_vidaAtual","_eventoMorte","Event","EventCustom","onLoad","getComponent","audioMorte","AudioSource","setUserData","node","find","on","sofrerDano","UP","reuse","emit","vidaAtual","vidaMaxima","update","deltaTime","direcaoAlvo","position","sub","distancia","mag","iniciarAtaque","andar","vagar","mudaAnimacao","atacar","direcao","setDirecao","andarPraFrente","Math","random","evento","detail","morrer","mul","destruirZumbi","dispatchEvent"],"mappings":"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","file":"Inimigo.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        alvo: cc.Node,\n        dano: cc.Float,\n        vida: cc.Float,\n        distanciaAtaque: cc.Float,\n        distanciaPerseguir: cc.Float,\n        tempoVagar: cc.Float,\n\n        _atacando: false,\n        _direcaoVagar: cc.Vec2,\n        _movimentacao: cc.Component,\n        _controleAnimacao: cc.Component,\n        _cronometroVagar: cc.Float,\n        _morto: false,\n        _vidaAtual: false,\n        _eventoMorte: cc.Event.EventCustom,\n    },\n\n    onLoad: function () {\n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this.audioMorte = this.getComponent(cc.AudioSource);\n\n        this._eventoMorte = new cc.Event.EventCustom(\"ZumbiMorreu\", true);\n        this._eventoMorte.setUserData(this.node);\n\n        this.alvo = cc.find(\"Personagens/Personagem\");\n        this.node.on(\"SofrerDano\", this.sofrerDano, this);\n\n        this._direcaoVagar = cc.Vec2.UP;\n        this._cronometroVagar = this.tempoVagar;\n\n        this._vidaAtual = this.vida;\n    },\n    \n    reuse: function () {\n        this._morto = false;\n        this._atacando = false;\n        this._vidaAtual = this.vida;\n        this.node.emit(\"atualizarVida\", { vidaAtual: this._vidaAtual, vidaMaxima: this.vida });\n    },\n\n    update: function (deltaTime) {\n        \n        if (!this._morto && !this._atacando) {\n            let direcaoAlvo = this.alvo.position.sub(this.node.position);\n\n            let distancia = direcaoAlvo.mag();\n\n            if (distancia < this.distanciaAtaque) {\n                this.iniciarAtaque(direcaoAlvo);            \n            } else if (distancia < this.distanciaPerseguir) {\n                this.andar(direcaoAlvo);\n            } else {\n                this.vagar(deltaTime);\n            }\n        }\n    },\n\n    iniciarAtaque: function(direcaoAlvo){\n        this._controleAnimacao.mudaAnimacao(direcaoAlvo, \"Ataque\");\n        this._atacando = true;\n    },\n\n    atacar: function () {\n        this._atacando = false;\n        this.alvo.emit(\"SofreDano\", { dano: this.dano });\n    },\n\n    andar: function (direcao) {\n        this._movimentacao.setDirecao(direcao);\n        this._movimentacao.andarPraFrente();\n        this._controleAnimacao.mudaAnimacao(direcao, \"Andar\");\n    },\n\n    vagar: function (deltaTime) {\n        this._cronometroVagar -= deltaTime;\n\n        if (this._cronometroVagar < 0) {\n            this._direcaoVagar = new cc.Vec2(Math.random() - .5, Math.random() - .5);\n            this._cronometroVagar = this.tempoVagar;\n        }\n\n        this.andar(this._direcaoVagar);\n    },\n\n    sofrerDano: function (evento) {\n        this._vidaAtual -= evento.detail.dano;\n\n        this.node.emit(\"atualizarVida\", { vidaAtual: this._vidaAtual, vidaMaxima: this.vida });\n        if (this._vidaAtual < 0) {\n            this.morrer();\n        }\n    },\n\n    morrer: function () {\n        this._morto = true;\n        let direcao = cc.Vec2.UP.mul(-1);\n        this._controleAnimacao.mudaAnimacao(direcao, \"Morte\");\n    },\n\n    destruirZumbi: function () {\n        this.node.emit(\"SoltarItem\");\n        this.node.dispatchEvent(this._eventoMorte);\n    }\n    \n});\n"]}