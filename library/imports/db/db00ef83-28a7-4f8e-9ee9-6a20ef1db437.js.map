{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\Inimigo.js"],"names":["cc","Class","extends","Component","properties","alvo","Node","dano","Float","vida","distanciaAtaque","distanciaPerseguir","tempoVagar","_atacando","_direcaoVagar","Vec2","_movimentacao","_controleAnimacao","_tempoRestanteParaVagar","_morto","_vidaAtual","_eventoMorte","Event","EventCustom","onLoad","getComponent","audioMorte","AudioSource","setUserData","node","find","on","sofrerDano","UP","inicializa","reuse","update","deltaTime","direcaoAlvo","position","sub","distancia","mag","iniciarAtaque","andar","vagar","emit","vidaAtual","vidaMaxima","mudaAnimacao","atacar","direcao","setDirecao","andarPraFrente","Math","random","evento","detail","morrer","mul","destruirZumbi","dispatchEvent"],"mappings":"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","file":"Inimigo.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        alvo: cc.Node,\n        dano: cc.Float,\n        vida: cc.Float,\n        distanciaAtaque: cc.Float,\n        distanciaPerseguir: cc.Float,\n        tempoVagar: cc.Float,\n\n        _atacando: false,\n        _direcaoVagar: cc.Vec2,\n        _movimentacao: cc.Component,\n        _controleAnimacao: cc.Component,\n        _tempoRestanteParaVagar: cc.Float,\n        _morto: false,\n        _vidaAtual: false,\n        _eventoMorte: cc.Event.EventCustom,\n    },\n\n    onLoad: function () {\n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this.audioMorte = this.getComponent(cc.AudioSource);\n\n        this._eventoMorte = new cc.Event.EventCustom(\"ZumbiMorreu\", true);\n        this._eventoMorte.setUserData(this.node);\n\n        this.alvo = cc.find(\"Personagens/Personagem\");\n        this.node.on(\"SofrerDano\", this.sofrerDano, this);\n\n        this._direcaoVagar = cc.Vec2.UP;\n        this._tempoRestanteParaVagar = this.tempoVagar;\n\n        this.inicializa();\n    },\n\n    reuse: function () {\n        this.inicializa();\n    },\n\n    update: function (deltaTime) {\n\n        if (!this._morto && !this._atacando) {\n            let direcaoAlvo = this.alvo.position.sub(this.node.position);\n\n            let distancia = direcaoAlvo.mag();\n\n            if (distancia < this.distanciaAtaque) {\n                this.iniciarAtaque(direcaoAlvo);\n            } else if (distancia < this.distanciaPerseguir) {\n                this.andar(direcaoAlvo);\n            } else {\n                this.vagar(deltaTime);\n            }\n        }\n    },\n\n    inicializa: function () {\n        this._morto = false;\n        this._atacando = false;\n        this._vidaAtual = this.vida;\n        this.node.emit(\"atualizarVida\", { vidaAtual: this._vidaAtual, vidaMaxima: this.vida });\n    },\n\n    iniciarAtaque: function (direcaoAlvo) {\n        this._controleAnimacao.mudaAnimacao(direcaoAlvo, \"Ataque\");\n        this._atacando = true;\n    },\n\n    atacar: function () {\n        this._atacando = false;\n        this.alvo.emit(\"SofreDano\", { dano: this.dano });\n    },\n\n    andar: function (direcao) {\n        this._movimentacao.setDirecao(direcao);\n        this._movimentacao.andarPraFrente();\n        this._controleAnimacao.mudaAnimacao(direcao, \"Andar\");\n    },\n\n    vagar: function (deltaTime) {\n        this._tempoRestanteParaVagar -= deltaTime;\n\n        if (this._tempoRestanteParaVagar < 0) {\n            this._direcaoVagar = new cc.Vec2(Math.random() - .5, Math.random() - .5);\n            this._tempoRestanteParaVagar = this.tempoVagar;\n        }\n\n        this.andar(this._direcaoVagar);\n    },\n\n    sofrerDano: function (evento) {\n        this._vidaAtual -= evento.detail.dano;\n\n        this.node.emit(\"atualizarVida\", { vidaAtual: this._vidaAtual, vidaMaxima: this.vida });\n        if (this._vidaAtual < 0) {\n            this.morrer();\n        }\n    },\n\n    morrer: function () {\n        this._morto = true;\n        let direcao = cc.Vec2.UP.mul(-1);\n        this._controleAnimacao.mudaAnimacao(direcao, \"Morte\");\n    },\n\n    destruirZumbi: function () {\n        this.node.emit(\"SoltarItem\");\n        this.node.dispatchEvent(this._eventoMorte);\n    }\n\n});\n"]}