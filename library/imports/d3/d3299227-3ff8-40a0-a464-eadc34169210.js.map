{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\Jogador.js"],"names":["Teclado","require","cc","Class","extends","Component","properties","tiro","Prefab","vidaMaxima","Float","_posicaoTiro","Node","_vidaAtual","_direcao","Vec2","_movimentacao","_controleAnimacao","_canvas","Canvas","_audioTiro","AudioSource","_eventoAlteraVida","Event","EventCustom","_eventoMorreu","_direcaoMouse","onLoad","getComponent","find","on","atirar","calcularDirecaoMouse","node","sofrerDano","recuperarVida","children","UP","mul","update","deltaTime","verificarTeclado","andar","atualizarAnimacao","mag","setDirecao","andarPraFrente","mudaAnimacao","estadoAtual","ZERO","estaPressionada","KEY","a","x","d","s","y","w","evento","detail","dano","dispararEventos","vidaAtual","parseFloat","cura","Math","min","dados","setUserData","dispatchEvent","estado","event","posicaoMouse","getLocation","convertToNodeSpaceAR","posicaoJogadora","Camera","main","position","sub","disparo","instantiate","iniciliza","parent","add","play"],"mappings":"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","file":"Jogador.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["let Teclado = require(\"Teclado\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tiro: cc.Prefab,\n        vidaMaxima: cc.Float,\n        _posicaoTiro: cc.Node,\n        _vidaAtual: cc.Float,\n        _direcao: cc.Vec2,\n        _movimentacao: cc.Component,\n        _controleAnimacao: cc.Component,\n        _canvas: cc.Canvas,\n        _audioTiro: cc.AudioSource,\n        _eventoAlteraVida: cc.Event.EventCustom,\n        _eventoMorreu: cc.Event.EventCustom,\n        _direcaoMouse: cc.Vec2,\n    },\n\n    onLoad: function () {\n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this._audioTiro = this.getComponent(cc.AudioSource);\n        this._canvas = cc.find(\"Canvas\");\n        this._canvas.on(\"mousedown\", this.atirar, this);\n        this._canvas.on(\"mousemove\", this.calcularDirecaoMouse, this);\n        this.node.on(\"SofreDano\", this.sofrerDano, this);\n        this.node.on(\"RecuperarVida\", this.recuperarVida, this);\n        this._vidaAtual = this.vidaMaxima;\n        this._eventoAlteraVida = new cc.Event.EventCustom(\"JogadoraPerdeuVida\", true);\n        this._eventoMorreu = new cc.Event.EventCustom(\"JogoAcabou\", true);\n        this._posicaoTiro = this.node.children[0];\n        this._direcaoMouse = cc.Vec2.UP.mul(-1);\n    },\n\n    update: function (deltaTime) {\n        this.verificarTeclado();\n        this.andar();\n        this.atualizarAnimacao();\n\n    },\n\n    andar: function () {\n        if (this._direcao.mag() != 0) {\n            this._movimentacao.setDirecao(this._direcao);\n            this._movimentacao.andarPraFrente();  \n        }\n    },\n\n    atualizarAnimacao: function(){\n        this._controleAnimacao.mudaAnimacao(this._direcaoMouse, this.estadoAtual());\n    },\n    \n    verificarTeclado: function () {\n        this._direcao = cc.Vec2.ZERO;\n\n        if (Teclado.estaPressionada(cc.KEY.a)) {\n            this._direcao.x -= 1;\n        }\n        if (Teclado.estaPressionada(cc.KEY.d)) {\n            this._direcao.x += 1;\n        }\n\n        if (Teclado.estaPressionada(cc.KEY.s)) {\n            this._direcao.y -= 1;\n        }\n        if (Teclado.estaPressionada(cc.KEY.w)) {\n            this._direcao.y += 1;\n        }\n    },\n\n    sofrerDano: function (evento) {\n        this._vidaAtual -= evento.detail.dano;\n\n        this.dispararEventos(this._eventoAlteraVida, { vidaAtual: this._vidaAtual, vidaMaxima: this.vidaMaxima });\n        if (this._vidaAtual < 0) {\n            this.dispararEventos(this._eventoMorreu);\n        }\n    },\n\n    recuperarVida: function (evento) {\n        this._vidaAtual += parseFloat(evento.detail.cura);\n        this._vidaAtual = Math.min(this._vidaAtual, this.vidaMaxima);\n        this.dispararEventos(this._eventoAlteraVida, { vidaAtual: this._vidaAtual, vidaMaxima: this.vidaMaxima });\n    },\n\n    dispararEventos: function (evento, dados) {\n        evento.setUserData(dados);\n        this.node.dispatchEvent(evento);\n    },\n\n    estadoAtual: function(){\n        let estado;\n        if (this._direcao.mag() == 0) {\n            estado = \"Parado\";\n        } else {\n            estado = \"Andar\";\n        }\n        return estado;\n    },\n\n    calcularDirecaoMouse: function (event) {\n        let posicaoMouse = event.getLocation();\n        posicaoMouse = new cc.Vec2(posicaoMouse.x, posicaoMouse.y);\n        posicaoMouse = this._canvas.convertToNodeSpaceAR(posicaoMouse);\n        let posicaoJogadora = cc.Camera.main.node.convertToNodeSpaceAR(this.node.position);\n\n        this._direcaoMouse = posicaoMouse.sub(posicaoJogadora);\n    },\n\n    atirar: function (event) {\n        let disparo = cc.instantiate(this.tiro);\n        disparo.getComponent(\"Tiro\").iniciliza(this.node.parent, this.node.position.add(this._posicaoTiro.position), this._direcaoMouse);\n        this._audioTiro.play();\n    },\n\n});\n"]}